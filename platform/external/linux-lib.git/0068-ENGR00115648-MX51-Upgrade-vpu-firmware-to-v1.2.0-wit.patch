From b0201f527da4a402a5c9e858dc1bc02630ba8998 Mon Sep 17 00:00:00 2001
From: Sammy <r62914@freescale.com>
Date: Wed, 19 Aug 2009 15:01:43 +0800
Subject: [PATCH 068/256] ENGR00115648 MX51: Upgrade vpu firmware to v1.2.0
 with vc1 bug fix

The firmware released on 20090819 fixed the bug:
[#691]: VC1 seek issue in the f/w 1.2.0

Signed-off-by: Sammy He <r62914@freescale.com>
---
 vpu/vpu_fw/vpu_fw_imx51.bin | Bin 139280 -> 139280 bytes
 vpu/vpu_lib.c               |  12 ++++++++++--
 2 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/vpu/vpu_fw/vpu_fw_imx51.bin b/vpu/vpu_fw/vpu_fw_imx51.bin
index e3fdd92223acd2a20c601d52ca56587474e8b95b..aca0d9f3128f04f24a8c9e1ad2ddcd7da8e12c5b 100644
GIT binary patch
delta 4912
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

delta 4736
zcmaJk30PBCy7#}?1IdMi5Ei)_Fy#_V1g%o_q6Be4t$XV-Wf;+pRjbunol!sc1$8>D
z?J4iRH+`)p4iy)m^YU8i?bngkR#99)6gw(4w5LyJsST)5aeMzwpgMl@-j^@uoPRn0
z`M2|*|L&^Q@2b^*ShWS*q<YIk&EKp%O$r3Irb8mcd1$p@u4XI#=yH8LHq_<+BDjp<
zDUh4nav+CfmgYiEU_t39fND~`eVFcBYg7hLza?$k9Y3!VckG3u<g*<a&`hrF*pK5|
zI}7381DAK+O@eR9#qu<0B6rIZ-A&d)m!U$HkxVPCY_7&{p-on6MpQ1Fp~^iZ7~5Fi
zPW&gednivUiT8t+luD~HSB-R@Ub3<oY^F82qb4$1=qWO6pTjun)ST7^?UvSqRx)qj
zJKRI7_Wi3buoYuNR|VWebQMmp6L&=#ILQ<o2ay#OO~d{gH>81K^!`F|oS4_gJAw7Z
zP|oJYV^ugZ{>h>T$4TOI;uMjmFNG;x5jxqtKTX%OuH2ty`e$m({>?Cu%sF6(g=E!%
z@utRjp1SNjeG&ivMH&wrgwM&^gDJ@K?!g6`fk<6Q42NcM5k5tOFlS)dA(IN;ChMy=
ztKW|I(18BKlNOjsn!cEk<5rpJVvNzr@SN4iG7Ls-0q}H`il<K-Yl9_>Dob6xEsL!#
z&B9n}#<labFfiw+3b<mU(8~A^h}(phLOh*9mVY^9{C6rvz^hE0pakDc4XOv>G>Bjo
zc$=^jxucD0#IHb(#Vk)(s$6uRAW(((H>l1%JiLK)e(78<aeIY7qTiA<+g#&AqRT+<
zu|^t)Qo2I5!50~Qg^~V^%@g!EcKK~0<Ifk($g>yeg9O$W9~2AnCKx+>Lf6d!F7bJB
zc*jRR@r~PlVf9VcH!j5b{t&8qjI*wNcqm`^L%UB1b0;GExR4J;?m#u0Rk?z;>b&r@
zOXVZAUkwnJMk%`Rw4YinXeK1k>0E6v7Or;=5X9-CsK-r=pQjI_Nz$=CU?szjxnmzj
z^VF(V+_92Ta&taebu0rUviI12=U1v5LWNixoXy-olR1pS2fCA?a-kxm^?!h-l_T~8
zvh4W4{&lK|`&hq{Tv1{rQVNYc{Wtte9E(9wWczd;ne`dzH>Byf!+y)m`pb~d!yzwM
z(aA(05>?lmi&bmiuMVerHKzIxWJsM8GDvaVtp01%n*@FP8=<kTWIDsJ7H5@j6$bFQ
z{&gJJs6B0pi5^2`C*XXHT&qh<YghC18})<RFNYSkvi?otOkp#gdr*DJWe;8&zPgR4
zGl=`d7$_qvPAoQs)NELSD!l*46SiEBA-q;+HL93dsk0~Q&MKMdqMlAnv#8l2#d}M`
z-Ye7X5k3h`l-Xc_5jvG!(}?$^)ljC}CTtHUWzosP*lC(iLlbZF^bO6LkQwLyBsC{r
zw0L!&pd|FOwlLUNNTT;N#8aOd!)ZNK?f*`kDi_E`+NB}Cs_(<%w5fg@aKvzG5R{S;
zr_!vy)+(-DqSfNKGQ3_#R-78YK1R#aXY^(oqh<Yl(d-@C`u0aqwRXzH@sGi^2-mkg
zqG#!l{utZ~;rh@c`g!dyx*;X-9-4<*Hi)C;Mlnxziql==$cWR$oL8sEuuK+H8-Ur;
zdWKY<c4F~tI{hDzNfw_ef;puA%s^N}9-eV~eY$dCC_2JJBgyiPZla9ou8Snl9=w$i
z{BFd*-?>Eg(3k4W6|2S7uX(8Aa0gj@b`qQ;pPikg>k98GCDsNf#E>Bk>9J2rcavoe
z&%z;cq#+x}wuTYt&Fscy?$`B<|9ZGm7Gk=55gdV4V4lH5U52?riGGT>(3KyYjR9>o
z7^#b#ZCnH=$gp$iFptbVSEM^(n2c#VFL3<ae&8baU|EA}!^T#g7L)bolVhL283n1a
z4U(nF$3d$TPX2^>RZN=BJ76!leclZ}2GTAV0IR&aIT6P(&4*z%fs4dBpR);eF<<y?
z$mP=b>_MxLNN;m0A-^D@UFG8Ghn$+;B8M-I&_q`EFD5#F;9`V$F;1|G79mbl9;*N0
z?7}>(UcX}W)d}>LnWrg%VPA6qK{Ea?iBLga{7ZS%RTS%@F@l9&CALe0jN!^Np}X?*
zBC9WLV()Y0!KL9)PjWBMaC&1RrH9445rdUug*kG7i`s?hq3)Yc4qqOlvzk>E2FeiK
z6)&`r!Yi4OMOIvK!*sIu%13ZIFso${03mOFvj(k>y6T3v$dIe=!ew&d>N0%w#{^R}
z?ij{@nKTBi2(JxJ!hAX%w8Nah_rXjP2|W`Zh`I5F8V&@S+UEiUNY1TX*iBa4O4C%D
z6X~nuy;}pjR~K%TBBki|Tix)@+Y4X|DeA}u2YIu@&RvKZjzJ$7Yotf9%&sCIb&LUT
z;C{#7!Rp0(=G7{>>7o<mDh#1FaQCMo;Jn(6F2<ihw}zjk-DJq!6!4O*T@Dyc_H{X(
z6SYfjsRcIJ2eyRRU~gtJp74s+Or0798-VKwzeL))9O=BF2m3MTk<QcQIu})H?!P)=
z#@!r9BX8cdiP^@n;@H<foSN`-XsQ6>SUDZ9r;$c$!Jj8*|M&II2-K$^Pb0jU-Sm8!
zT)#UTvdPGMZbO8Gc9B*0av+iX>0W;>&ZsExHP)3x15e|~kN1*wSvtLsp;;vMzI}Zb
z-clpY(&fpQ+Vasi`tUkWUfA}6tQ?x9dvY$2r$0f-mm|9rZr1M*e;MA_C#<3(*+{?C
zK2lxba&*&X4wZL^{2qPv<Q{~)GYn7pd2?m=iothe@W)d>Mo+CQ8*V`LTkogORm7V`
zIg}?S&;ht!Dkjj;x}{j1XX_Yz&e4a6edlLsd2*^~q&CE*i4l5lTn`Q9qe*#kKjc$P
zK}Q+okUHWvvgpApj=8$H3|sC2LA_sjDNDlK3YUv&ySeT@NY**@VKYg}!&eLreV**b
zvwD-Vhv}G|pFMQv+(F61jDtf<#ig$)ZgJ?Jgm<+nvF|J3K7D~Kh|ws)QRaXYaFmUJ
z^c=fE(NGzcUxCbuX0-8HJgYD2K13`CQzQAK@bQ#48mYa^2iEl$^sIj<b_FbQsYDi2
zz-~~}6?hISM*9+wGf#ddEJX>Za>mmL4Z{E6Zn=4K4nio;5IF~ThNZB3`ieb!oXD%B
zQIDpq5bYD%Rf199K3X;^?9vDTo6T;REUT+_it1{0^%OB%9N^Q^gVF*(Q|(eIKz63x
zFj!C(jKkO{(jqnu#kc#L&dFP*Y)S}D6$cBmu~PBWEPV&?CXAMrvoIb?q$4a8L8p|W
zf*hQlQ$Z$98&z;5>Y{=1UkUd*-kR}h_#C4C5q-d=sbKwy^dB{LE!bJ8l=|yoK8&c5
z^sp9yk!(gNgrQQg5yfqiBqPiixROi7qCQiI56++P4Br1zY^Kkf9<QiMH8o<nZZrQz
zSdOjUR>=_sM<Gf2J_^2qXQhMDkPNe=<IzyaZN-w_pR2<TYc*cftx|6j(hSlt6Z{p_
zlG6;o?_a`s=!FTIAfs(ImIc||W`W()EV983jM7V&aE!kh&6<iSKP@4NmPoB;m=yaq
zqR&5uep~W#kP886J%?_-F1^Qr8@*P~!BzGyCmo7`0kBcJ8iU_v8*A<;Q|4jIC6s?u
zGgACB&i5<}!!3|mJ5n5urD~*DAdF1d(6Jh64k_0HiJ4ntcZ9zRJYs)wdY|VeXwNP|
z;th*}73j;T_RF|wYJ!^Hlr~zxX?0je3I$mDTsI9u0{sl1qOH<l3x@2B^t}bLx#unG
zd}C3BSG!QgQF2-#)6mPpQ^tn3M4DxVG)->=mrEP1sIgso*9y7oU$-2<J(clng`Sew
zJY}bL$xWWVW-%iCB;|elNGV4duUlqgDN%UMh>7q<;5V=dt?b^5FG<@pVN`-5xkN}8
z`(VQF45eZsK5t=tN;-I@8F4Ty<(TzT%n%u)-(phoG~P4~?Vl#9&noIx$H5?5xkVFP
z#3WX!_VkrU2jhcE7ga9ZiGz2+E0x)xckj~{rPsRAp`6kc+A7GQSL;fj+CEWNH7cm0
zEmD&Wvh5Cw^2!*n?p2`!8Jn_2Q6o7XU1E|3#lsQqn3eGti!;R+um+$mlFAOtO`qWR
zxNLRP*j${Y&2~(Wze}InA<?9KsXwAzv%?@$RNUjJj0EU!O^=Jswd5+_j*%5lO*M-W
zpd3i>w-(8g1WTeeqo5=4Gf}ra((jTWGrPqUg^||VQ|le|db-4R0ux_xPUPd{7vh#i
zU`m7{EQ5;Uc)CEkmIU*;-&<$m3q3?|g_Jjbk5rTl8JR66NBy17RFu<%M*sg({*(;w
zIpX3LquA3{6I~wvOF>-~HG!?tpDh-iI=ib;jZI{W^hz)ES-iBP7i6cI;u!y&R$xn7
zjcjbLVyXol)nh=!k1f3*N7rHs12xGh@Tmq4OBYk&2xufJ4YG?4$MCcc|GV(R<#&<d
z6YfK{w`~x9Y9EdtBOk)d&^pY!(b|cf>ku9ROece_#`zAV)etcEyxMgg8-(p`E;-M)
zJ*3=(G`-Sz;C<)|IhM!~Jw0rI6Iw}djh|%Q(&BBmJ7G?wUy{~3VFm1#ZaQIOH)hpS
zFz5ehp}tmHC~06iG+{q<zvFYMPJnUIJ=Sy|(k{igV6|<zHFDV__ae;}zBSTr7mR_;
z(lr-&VUCoM33sAo^n7M~B;DNoAOjXjGy1_I*j#h8A6C8C7E>fG+T**^Li*7S`+i0j
n+k4RaJmA%Y)1&4G4>+^;S!yAs28UY9zH=qer{<g=hOhl!EqXW^

diff --git a/vpu/vpu_lib.c b/vpu/vpu_lib.c
index e3e8e69..d61fb12 100644
--- a/vpu/vpu_lib.c
+++ b/vpu/vpu_lib.c
@@ -2597,6 +2597,7 @@ RetCode vpu_DecStartOneFrame(DecHandle handle, DecParam * param)
 		/* if iframeSearch is Enable, other bit is ignored. */
 		if (param->iframeSearchEnable == 1) {
 			val |= ((param->iframeSearchEnable & 0x1) << 2);
+			pDecInfo->vc1BframeDisplayValid = 0;
 		} else if (param->skipframeMode) {
 			val |= (param->skipframeMode << 3);
 			val |= (param->prescanMode << 1);
@@ -2770,7 +2771,13 @@ RetCode vpu_DecGetOutputInfo(DecHandle handle, DecOutputInfo * info)
 	}
 
 	val = VpuReadReg(RET_DEC_PIC_TYPE);
-	info->picType = val & 0xff;
+
+	if (pCodecInst->codecMode == VC1_DEC &&
+	    pDecInfo->initialInfo.profile == 2) /* VC1 AP propile */
+		info->picType = val & 0x3f;
+	else
+		info->picType = val & 0x7;
+
 	info->interlacedFrame = (val >> 16) & 0x1;
 
 	if (cpu_is_mx37() || cpu_is_mx51()) {
@@ -2939,7 +2946,8 @@ RetCode vpu_DecGetOutputInfo(DecHandle handle, DecOutputInfo * info)
 
 	if (pCodecInst->codecMode == VC1_DEC && info->indexFrameDisplay != -3) {
 		if (pDecInfo->vc1BframeDisplayValid == 0) {
-			if (info->picType == 2) {
+			if ((info->picType == 3 && pDecInfo->initialInfo.profile != 2) ||
+			    ((info->picType >> 3) == 3 && pDecInfo->initialInfo.profile == 2)) {
 				/* clear buffer for not displayed B frame */
 				val = ~(1 << info->indexFrameDisplay);
 				val &= VpuReadReg(pDecInfo->frameDisplayFlagRegAddr);
-- 
1.8.0

